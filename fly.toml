# fly.toml file is generated for reactivities-course on cource 260. It is generated by fly.io to create deployment
# command is: fly launch --image yordy/reactivites-deploy:latest . You have to have account with fly.io

app = "reactivities-course"
kill_signal = "SIGINT"
kill_timeout = 5
processes = []

[build]
  image = "yordy/reactivities-deploy:latest"

# [env] section is added to configure fly.io environment. These added below are non confidential entries. 
# Note with ASPNETCORE_URLS we say our application has to listen at port 8080
# Confidential appSetting.json keys are added to Fly.io secrets.
# Setting from appsettings.json added to Fly.io secrets are below: 
# ApiSecret: It has the same value as the one in appsettings.json
# TokenKey: Command used to set up secret is: fly set TokenKey=XXXX
# DATABASE_URL: is added to Fly.io secrets when this file is generated during first "fly deploy" call. It is connection to Postgres db.
# 
[env]
  ASPNETCORE_URLS="http://+:8080"
  Cloudinary__CloudName="db5zpgvc8"
  Cloudinary__ApiKey="953596764185626"

[experimental]
  allowed_public_ports = []
  auto_rollback = true

# fly.io is going to run container internaly on port 8080 
[[services]]
  http_checks = []
  internal_port = 8080
  processes = ["app"]
  protocol = "tcp"
  script_checks = []
  [services.concurrency]
    hard_limit = 25
    soft_limit = 20
    type = "connections"

  [[services.ports]]
    force_https = true
    handlers = ["http"]
    port = 80

  [[services.ports]]
    handlers = ["tls", "http"]
    port = 443

  [[services.tcp_checks]]
    grace_period = "1s"
    interval = "15s"
    restart_limit = 0
    timeout = "2s"
